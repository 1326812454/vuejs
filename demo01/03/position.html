<!DOCTYPE html>
<html>
  <head>
    <title>dialog标签</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=pTeC0IZvnpLiWdXUgBzrSUQ0l0gQPcjS"></script>
    <style>
      *{margin:0;padding:0;}
      #map {height:90vh;}
      #position{
        height: 10vh;
        width:100%;
        text-align:center;
      }
      #position span {
        display:inline-block;
        height:50px;
        line-height:50px;
        margin:10px;
        text-align:center;
        width: 80px;
        background:blue;
        color:#fff;
        font-size:16px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div id="position">
      <span id="startBtn">开始定位</span>
      <span id="endBtn">结束定位</span>
      <span id="printData">当前数据</span>
    </div>
  </body>
  <script>
  let startBtn = document.querySelector('#startBtn');
  let endBtn = document.querySelector('#endBtn');
  let printData = document.querySelector('#printData');
  let map = new BMap.Map("map");
  let timeId = null;
  map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);
  map.enableScrollWheelZoom(true);
  let position = [new BMap.Point(114.02597366, 22.54605355), new BMap.Point(114.02597366, 22.54605355)];
  
	function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition.getCurrentPosition(function (res) {
        if (this.getStatus() == BMAP_STATUS_SUCCESS) {
          let lat = res && res.point.lat;
          let lon = res && res.point.lng;
          position.push(new BMap.Point(lat, lon));
        }
      //是否启用高精确度模
      }, function (err) {

      }, {
        enableHighAccuracy: true, //是否获取高精度经纬度，默认值为false
        timeout: 5000, //获取位置信息的超时时间。单位为毫秒（ms），默认值为不超时
        maximumAge: 0, //获取位置信息的缓存时间。单位为毫秒（ms），默认值为0（立即更新获取）。如果设备缓存的位置信息超过指定的缓存时间，将重新更新位置信息后再返回。
        provider: /*(String 类型 )优先使用的定位模块。可取以下供应者： "system"：表示系统定位模块，支持wgs84坐标系； "baidu"：表示百度定位模块，支持gcj02/bd09/bd09ll坐标系； 
                  "amap"：表示高德定位模板，支持gcj02坐标系。 默认值按以下优先顺序获取（amap>baidu>system），若指定的provider不存在或无效则返回错误回调。 
                  注意：百度/高德定位模块需要配置百度/高德地图相关参数才能正常使用。平台支持Android - 2.2+ (支持)，iOS - 4.5+ (支持): provider为“baidu”时，
                  仅支持bd09ll坐标系，暂不支持高德定位模块。*/
        coordsType: /*(String 类型 )指定获取的定位数据坐标系类型。可取以下坐标系类型： “wgs84”：表示WGS-84坐标系；
                  “gcj02”：表示国测局经纬度坐标系； “bd09”：表示百度墨卡托坐标系； “bd09ll”：表示百度经纬度坐标系； 
                    provider为“system”时，默认使用“wgs84”类型；provider为“baidu”是，默认使用“bd09ll”类型。 
                    如果设置的坐标系类型provider不支持，则返回错误。*/

        geocode: /*(Boolean 类型 )是否解析地址信息。解析的地址信息保存到Position对象的address、addresses属性中，
                true表示解析地址信息，false表示不解析地址信息，返回的Position对象的address、addresses属性值为undefined，默认值为true。 
                如果解析地址信息失败则返回的Position对象的address、addresses属性值为null。*/
      });
    } else {
      alert('手机不支持经纬度定位！');
    }
	}

  startBtn.onclick = function () {
    position = [];
    timeId = setInterval(getLocation, 5000);
  };

  endBtn.onclick = function () {
    clearInterval(timeId);
    let driving = new BMap.DrivingRoute(map, {renderOptions:{map: map, autoViewport: true}});
    let start = new BMap.Point(position[0].lat, position[0].lng);
    let end = new BMap.Point(position[position.length - 1].lat, position[position.length - 1].lng);
    let waypoints = position.slice(1, (position.length - 1));
    driving.search(start, end, {waypoints: [position[0], position[1]]});//waypoints表示途经点
    alert('完成！');
  };
  printData.onclick = function () {
    console.log(position);
  };
  </script>
</html>
